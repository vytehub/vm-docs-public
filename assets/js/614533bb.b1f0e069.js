"use strict";(self.webpackChunkvyte_merge_docs=self.webpackChunkvyte_merge_docs||[]).push([[619],{4327:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"modulos/VyteMerge_Search_Feed_IR_Service","title":"VyteMerge \u2014 Search & Feed (IR Service) \u2014 Dise\xf1o & Decisi\xf3n","description":"1) Contexto / Objetivo","source":"@site/docs/modulos/VyteMerge_Search_Feed_IR_Service.md","sourceDirName":"modulos","slug":"/modulos/VyteMerge_Search_Feed_IR_Service","permalink":"/vm-docs-public/docs/modulos/VyteMerge_Search_Feed_IR_Service","draft":false,"unlisted":false,"editUrl":"https://github.com/vytehub/vm-docs/tree/main/docs/modulos/VyteMerge_Search_Feed_IR_Service.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"M\xf3dulo de Offerings","permalink":"/vm-docs-public/docs/modulos/Offerings"},"next":{"title":"Epicas","permalink":"/vm-docs-public/docs/category/epicas"}}');var r=n(4848),d=n(8453);const c={},l="VyteMerge \u2014 Search & Feed (IR Service) \u2014 Dise\xf1o & Decisi\xf3n",o={},t=[{value:"1) Contexto / Objetivo",id:"1-contexto--objetivo",level:2},{value:"2) Alcance",id:"2-alcance",level:2},{value:"3) Requisitos",id:"3-requisitos",level:2},{value:"Funcionales",id:"funcionales",level:3},{value:"No funcionales (MVP)",id:"no-funcionales-mvp",level:3},{value:"4) Dise\xf1o",id:"4-dise\xf1o",level:2},{value:"4.1 Arquitectura (alto nivel)",id:"41-arquitectura-alto-nivel",level:3},{value:"4.2 Flujos",id:"42-flujos",level:3},{value:"5) Data Model (vista IR)",id:"5-data-model-vista-ir",level:2},{value:"5.1 \xcdndices en Azure AI Search (ejemplo <code>offering-index</code>)",id:"51-\xedndices-en-azure-ai-search-ejemplo-offering-index",level:3},{value:"5.2 Features online (Redis \u2014 ejemplos)",id:"52-features-online-redis--ejemplos",level:3},{value:"6) API (contratos IR)",id:"6-api-contratos-ir",level:2},{value:"6.1 <code>/search</code>",id:"61-search",level:3},{value:"6.2 <code>/feed</code>",id:"62-feed",level:3},{value:"6.3 <code>/feedback</code> (opcional si no us\xe1s eventos para se\xf1ales)",id:"63-feedback-opcional-si-no-us\xe1s-eventos-para-se\xf1ales",level:3},{value:"7) Ranking (MVP \u2192 Fase 1.5)",id:"7-ranking-mvp--fase-15",level:2},{value:"8) Ingesta &amp; Se\xf1ales",id:"8-ingesta--se\xf1ales",level:2},{value:"8.1 Eventos de dominio (Service Bus)",id:"81-eventos-de-dominio-service-bus",level:3},{value:"8.2 Se\xf1ales de comportamiento",id:"82-se\xf1ales-de-comportamiento",level:3},{value:"9) Seguridad &amp; Privacidad",id:"9-seguridad--privacidad",level:2},{value:"10) Costos (resumen pr\xe1ctico)",id:"10-costos-resumen-pr\xe1ctico",level:2},{value:"11) KPIs &amp; Observabilidad",id:"11-kpis--observabilidad",level:2},{value:"12) Roadmap de Evoluci\xf3n",id:"12-roadmap-de-evoluci\xf3n",level:2},{value:"13) ADR \u2014 IR\u2011001 (Decisi\xf3n de Arquitectura)",id:"13-adr--ir001-decisi\xf3n-de-arquitectura",level:2},{value:"14) Test / Acceptance Criteria",id:"14-test--acceptance-criteria",level:2},{value:"15) Riesgos &amp; Open Questions",id:"15-riesgos--open-questions",level:2},{value:"\u2705 Checklist / Next Steps",id:"-checklist--next-steps",level:2}];function a(e){const s={blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"vytemerge--search--feed-ir-service--dise\xf1o--decisi\xf3n",children:"VyteMerge \u2014 Search & Feed (IR Service) \u2014 Dise\xf1o & Decisi\xf3n"})}),"\n",(0,r.jsx)(s.h2,{id:"1-contexto--objetivo",children:"1) Contexto / Objetivo"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Objetivo:"})," definir el dise\xf1o espec\xedfico de ",(0,r.jsx)(s.strong,{children:"Search & Feed"})," para VyteMerge con foco en ",(0,r.jsx)(s.strong,{children:"costo\u2013beneficio\u2013velocidad"})," sin perder ",(0,r.jsx)(s.strong,{children:"control"})," sobre la relevancia.",(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.strong,{children:"Decisi\xf3n principal:"})," ",(0,r.jsxs)(s.strong,{children:["Servicio IR (Intelligence & Retrieval) en ",(0,r.jsx)(s.em,{children:"Python + FastAPI"})]})," que ",(0,r.jsx)(s.strong,{children:"orquesta candidatos y re-ranking"}),", utilizando ",(0,r.jsx)(s.strong,{children:"Azure AI Search"})," como motor ",(0,r.jsx)(s.strong,{children:"gestionado"})," de indexado, BM25 y ",(0,r.jsx)(s.strong,{children:"vector search"}),". ",(0,r.jsx)(s.strong,{children:"Embeddings"})," generados ",(0,r.jsx)(s.strong,{children:"offline (batch)"})," con ",(0,r.jsx)(s.strong,{children:"Azure OpenAI"}),". ",(0,r.jsx)(s.strong,{children:"Contratos REST"})," estables (",(0,r.jsx)(s.code,{children:"/search"}),", ",(0,r.jsx)(s.code,{children:"/feed"}),", ",(0,r.jsx)(s.code,{children:"/feedback"}),") expuestos por IR y consumidos por el ",(0,r.jsx)(s.strong,{children:"BFF .NET"}),". Se\xf1ales v\xeda ",(0,r.jsx)(s.strong,{children:"Service Bus"}),"."]}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["Razonamiento: \u201cbuy\u201d lo infra\u2011pesado (\xedndice, ANN, sharding) y \u201cbuild\u201d lo diferencial (features, ranking, mezcla de se\xf1ales). Mantiene salida r\xe1pida y control futuro (proveedor ",(0,r.jsx)(s.strong,{children:"pluggable"}),")."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"2-alcance",children:"2) Alcance"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Incluye"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"IR Service (Python FastAPI): retrieval h\xedbrido (texto + vector), re\u2011ranking, features online (Redis), APIs p\xfablicas de Search/Feed, indexador por eventos."}),"\n",(0,r.jsxs)(s.li,{children:["Azure AI Search: \xedndices ",(0,r.jsx)(s.code,{children:"offering"}),", ",(0,r.jsx)(s.code,{children:"slot"}),", ",(0,r.jsx)(s.code,{children:"profile"}),", ",(0,r.jsx)(s.code,{children:"post"})," con campos texto, facets y vector."]}),"\n",(0,r.jsxs)(s.li,{children:["Azure OpenAI: embeddings ",(0,r.jsx)(s.strong,{children:"batch"})," en ingesta."]}),"\n",(0,r.jsxs)(s.li,{children:["Redis: cach\xe9 de consultas/facets y ",(0,r.jsx)(s.strong,{children:"features"})," (contadores recientes, afinidad)."]}),"\n",(0,r.jsx)(s.li,{children:"Azure Service Bus: eventos de dominio y se\xf1ales de comportamiento."}),"\n",(0,r.jsx)(s.li,{children:"BFF .NET: fachada estable para Web (y futuro Mobile)."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"No incluye"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Operaci\xf3n de Elastic/pgvector/Qdrant on\u2011prem (se deja plan de migraci\xf3n)."}),"\n",(0,r.jsx)(s.li,{children:"Modelos neurales pesados en l\xednea (se inicia con reglas + LGBM/XGBoost)."}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"3-requisitos",children:"3) Requisitos"}),"\n",(0,r.jsx)(s.h3,{id:"funcionales",children:"Funcionales"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/search"}),": consulta h\xedbrida (BM25 \u2295 sem\xe1ntico) con filtros (geo, tiempo, categor\xeda, privacidad)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/feed"}),": recomendaciones personalizadas por usuario y contexto (near/timebox)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/feedback"}),": recepci\xf3n de se\xf1ales (opcional si no viajan por eventos)."]}),"\n",(0,r.jsxs)(s.li,{children:["Actualizaci\xf3n de \xedndices ",(0,r.jsx)(s.strong,{children:"< 10s"})," tras publicar/editar un ",(0,r.jsx)(s.strong,{children:"Slot"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"no-funcionales-mvp",children:"No funcionales (MVP)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"p95"})," ",(0,r.jsx)(s.code,{children:"/search"})," y ",(0,r.jsx)(s.code,{children:"/feed"})," \u2264 ",(0,r.jsx)(s.strong,{children:"300 ms"})," (staging, sin im\xe1genes)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Disponibilidad"})," \u2265 99.5%."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Observabilidad E2E"})," (traceId FE\u2192BFF\u2192IR\u2192AI Search/Redis)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Privacidad"}),": respeto de ",(0,r.jsx)(s.strong,{children:"visibilidad"})," por cuenta/timeline/slot y ",(0,r.jsx)(s.strong,{children:"opt\u2011in"})," para datos de localizaci\xf3n."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"4-dise\xf1o",children:"4) Dise\xf1o"}),"\n",(0,r.jsx)(s.h3,{id:"41-arquitectura-alto-nivel",children:"4.1 Arquitectura (alto nivel)"}),"\n",(0,r.jsx)(s.mermaid,{value:"flowchart TB\n  FE[Web Angular] --\x3e BFF[BFF .NET (Minimal APIs)]\n  BFF --\x3e IR[IR Service (Python FastAPI)]\n  IR --\x3e AIS[Azure AI Search (texto+vector)]\n  IR --\x3e AOE[Azure OpenAI (embeddings batch)]\n  IR --\x3e RED[Redis (cache & features online)]\n  MONO[Modular Monolith .NET (CQRS + Outbox)] --\x3e BUS[Azure Service Bus]\n  BUS --\x3e IR\n  MONO --\x3e DB[(SQL Server / PostgreSQL)]"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Notas clave"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"IR"})," define esquema l\xf3gico, mezcla BM25+vector y aplica ",(0,r.jsx)(s.strong,{children:"re\u2011ranking"})," con features propias (geo/tiempo/social/popularidad/campa\xf1as)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"AI Search"})," maneja indexado, particionado, r\xe9plicas y ANN. IR es ",(0,r.jsx)(s.strong,{children:"due\xf1o"})," del ranking final."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Provider pluggable"}),": IR implementa una interfaz ",(0,r.jsx)(s.code,{children:"SearchProvider"})," \u2192 ",(0,r.jsx)(s.code,{children:"AzureSearchProvider"})," (hoy) / ",(0,r.jsx)(s.code,{children:"ElasticProvider"})," (futuro)."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"42-flujos",children:"4.2 Flujos"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"B\xfasqueda"})}),"\n",(0,r.jsx)(s.mermaid,{value:"sequenceDiagram\n  participant UI as Web (Angular)\n  participant BFF as BFF .NET\n  participant IR as IR Service (FastAPI)\n  participant AIS as Azure AI Search\n  participant RED as Redis Cache\n  UI->>BFF: GET /search?q&filters...\n  BFF->>IR: GET /search...\n  IR->>RED: get(cacheKey)\n  alt cache hit\n    RED--\x3e>IR: items+facets\n  else miss\n    IR->>AIS: query h\xedbrida (BM25 + vector) + filtros\n    AIS--\x3e>IR: top-K candidatos\n    IR->>IR: re-ranking (reglas/LGBM) + facets\n    IR->>RED: set(cacheKey, ttl)\n  end\n  IR--\x3e>BFF: items + facets + cursor\n  BFF--\x3e>UI: 200"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Feed"})}),"\n",(0,r.jsx)(s.mermaid,{value:"sequenceDiagram\n  participant UI as Web (Angular)\n  participant BFF as BFF .NET\n  participant IR as IR Service\n  participant RED as Redis (features)\n  participant BUS as Service Bus\n  UI->>BFF: GET /feed?userId&near&timebox\n  BFF->>IR: GET /feed...\n  IR->>RED: read features (afinidad, CTR, popularidad)\n  IR->>IR: recall (ANN + reglas) -> re-ranking\n  IR--\x3e>BFF: feed items\n  Note over BUS,IR: se\xf1ales (views/clicks/bookings) llegan v\xeda eventos y actualizan features"}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"5-data-model-vista-ir",children:"5) Data Model (vista IR)"}),"\n",(0,r.jsxs)(s.h3,{id:"51-\xedndices-en-azure-ai-search-ejemplo-offering-index",children:["5.1 \xcdndices en Azure AI Search (ejemplo ",(0,r.jsx)(s.code,{children:"offering-index"}),")"]}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Campo"}),(0,r.jsx)(s.th,{children:"Tipo"}),(0,r.jsx)(s.th,{children:"Flags"}),(0,r.jsx)(s.th,{children:"Notas"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"id"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"key"}),(0,r.jsx)(s.td,{children:"GUID"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ownerId"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"filter"}),(0,r.jsx)(s.td,{children:"para filtrar por due\xf1o"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"title"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"searchable"}),(0,r.jsx)(s.td,{children:"analyzer std"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"description"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"searchable"}),(0,r.jsx)(s.td,{children:"analyzer std"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"categories"})}),(0,r.jsx)(s.td,{children:"collection(string)"}),(0,r.jsx)(s.td,{children:"searchable, filter, facet"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"geo"})}),(0,r.jsx)(s.td,{children:"GeographyPoint"}),(0,r.jsx)(s.td,{children:"filter, sort"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"lat,lon"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"price"})}),(0,r.jsx)(s.td,{children:"number"}),(0,r.jsx)(s.td,{children:"filter, sort, facet"}),(0,r.jsxs)(s.td,{children:["buckets ",(0,r.jsx)(s.code,{children:"priceRange"})]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"durationMin"})}),(0,r.jsx)(s.td,{children:"int"}),(0,r.jsx)(s.td,{children:"filter, facet"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"visibility"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"filter"}),(0,r.jsx)(s.td,{children:"Public/Unlisted/Private"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"timelineVisibility"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"filter"}),(0,r.jsx)(s.td,{children:"Public/Private"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"embedding_v1"})}),(0,r.jsx)(s.td,{children:"collection(single) of Edm.Single"}),(0,r.jsx)(s.td,{children:"searchable (vector)"}),(0,r.jsx)(s.td,{children:"dim=1536/768"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"updatedAt"})}),(0,r.jsx)(s.td,{children:"Edm.DateTimeOffset"}),(0,r.jsx)(s.td,{children:"filter, sort"}),(0,r.jsx)(s.td,{children:"freshness"})]})]})]}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["\xcdndices adicionales: ",(0,r.jsx)(s.code,{children:"slot-index"})," (con ",(0,r.jsx)(s.code,{children:"start"}),", ",(0,r.jsx)(s.code,{children:"end"}),", ",(0,r.jsx)(s.code,{children:"capacity"}),", ",(0,r.jsx)(s.code,{children:"location"}),"), ",(0,r.jsx)(s.code,{children:"profile-index"}),", ",(0,r.jsx)(s.code,{children:"post-index"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Ejemplo schema (fragmento JSON)"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "name": "offering-index",\n  "fields": [\n    { "name": "id", "type": "Edm.String", "key": true, "filterable": true },\n    { "name": "title", "type": "Edm.String", "searchable": true, "analyzer": "standard.lucene" },\n    { "name": "categories", "type": "Collection(Edm.String)", "searchable": true, "filterable": true, "facetable": true },\n    { "name": "geo", "type": "Edm.GeographyPoint", "filterable": true, "sortable": true },\n    { "name": "embedding_v1", "type": "Collection(Edm.Single)", "searchable": true, "dimensions": 1536, "vectorSearchProfile": "v1" }\n  ]\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"52-features-online-redis--ejemplos",children:"5.2 Features online (Redis \u2014 ejemplos)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"popularity:offering:{id}:ctr_24h"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"affinity:user:{u}:owner:{o}"})}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"geo_hot:{tile}"})," (contadores por zona)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"freshness:slot:{id}"})," (penaliza slots vencidos)"]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"6-api-contratos-ir",children:"6) API (contratos IR)"}),"\n",(0,r.jsxs)(s.h3,{id:"61-search",children:["6.1 ",(0,r.jsx)(s.code,{children:"/search"})]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Query params"})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Param"}),(0,r.jsx)(s.th,{children:"Tipo"}),(0,r.jsx)(s.th,{children:"Descripci\xf3n"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"q"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"texto libre (opcional)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"when"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsxs)(s.td,{children:["rango temporal (",(0,r.jsx)(s.code,{children:"today"}),", ",(0,r.jsx)(s.code,{children:"2025-08-20..2025-08-27"}),")"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"near"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"lat,lon,radiusKm"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"category"})}),(0,r.jsx)(s.td,{children:"string[]"}),(0,r.jsx)(s.td,{children:"una o varias categor\xedas"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"visibility"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsxs)(s.td,{children:[(0,r.jsx)(s.code,{children:"public"})," por defecto"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"cursor"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"paginaci\xf3n por cursor"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"limit"})}),(0,r.jsx)(s.td,{children:"int"}),(0,r.jsx)(s.td,{children:"tama\xf1o de p\xe1gina (def: 20)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"fields"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"proyecci\xf3n (para mobile)"})]})]})]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Respuesta (200)"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "items": [\n    {\n      "id": "off_123",\n      "type": "offering",\n      "title": "Clases de yoga",\n      "score": 0.87,\n      "why": { "bm25": 0.42, "vector": 0.28, "geo": 0.1, "time": 0.07 }\n    }\n  ],\n  "facets": { "category": [{ "key": "fitness", "count": 120 }] },\n  "cursorNext": "eyJwYWdlIjoyfQ==",\n  "debug": { "weights": { "bm25": 0.4, "vector": 0.4, "geo": 0.1, "time": 0.1 } }\n}\n'})}),"\n",(0,r.jsxs)(s.h3,{id:"62-feed",children:["6.2 ",(0,r.jsx)(s.code,{children:"/feed"})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Query params"}),": ",(0,r.jsx)(s.code,{children:"userId"}),", ",(0,r.jsx)(s.code,{children:"near"}),", ",(0,r.jsx)(s.code,{children:"timebox"}),", ",(0,r.jsx)(s.code,{children:"cursor"}),", ",(0,r.jsx)(s.code,{children:"limit"}),", ",(0,r.jsx)(s.code,{children:"fields"}),(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.strong,{children:"Respuesta (200)"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "items": [\n    { "id": "slot_456", "type": "slot", "title": "Corte 30\'", "start": "2025-08-21T10:30:00Z", "score": 0.91 }\n  ],\n  "cursorNext": "eyJvZmZzZXQiOjIwfQ=="\n}\n'})}),"\n",(0,r.jsxs)(s.h3,{id:"63-feedback-opcional-si-no-us\xe1s-eventos-para-se\xf1ales",children:["6.3 ",(0,r.jsx)(s.code,{children:"/feedback"})," (opcional si no us\xe1s eventos para se\xf1ales)"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Body"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{ "itemId": "slot_456", "type": "click", "userId": "u_1", "ts": "2025-08-20T12:00:00Z" }\n'})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Respuesta"}),": ",(0,r.jsx)(s.code,{children:"202 Accepted"})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"7-ranking-mvp--fase-15",children:"7) Ranking (MVP \u2192 Fase 1.5)"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Score final (MVP \u2014 reglas)"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"score = wb*bm25 + ws*vectorSim + wg*geoScore + wt*timeFit + wa*affinity + wp*popularity + wc*campaignBoost\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"bm25"}),": score de texto (AI Search)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"vectorSim"}),": coseno entre embedding consulta y doc."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"geoScore"}),": decae con distancia."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"timeFit"}),": cercan\xeda al hueco de usuario (si hay ",(0,r.jsx)(s.code,{children:"when"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"affinity"}),": afinidad social (sigo al owner, seguidores en com\xfan)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"popularity"}),": CTR reciente (Redis)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"campaignBoost"}),": multiplicador de campa\xf1as."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Fase 1.5 \u2014 LGBM/XGBoost"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Features: las anteriores + ",(0,r.jsx)(s.code,{children:"price_norm"}),", ",(0,r.jsx)(s.code,{children:"duration_norm"}),", ",(0,r.jsx)(s.code,{children:"topic_match"}),", ",(0,r.jsx)(s.code,{children:"freshness"}),", ",(0,r.jsx)(s.code,{children:"device_type"}),", ",(0,r.jsx)(s.code,{children:"hour_bucket"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Entrenamiento offline (Python). ",(0,r.jsx)(s.strong,{children:"Serving"})," en IR (Python) o export ",(0,r.jsx)(s.strong,{children:"ONNX"})," si migrase a .NET."]}),"\n",(0,r.jsx)(s.li,{children:"A/B simple via feature flag en BFF."}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"8-ingesta--se\xf1ales",children:"8) Ingesta & Se\xf1ales"}),"\n",(0,r.jsx)(s.h3,{id:"81-eventos-de-dominio-service-bus",children:"8.1 Eventos de dominio (Service Bus)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"slot_published|updated|archived"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"slot_booked|booking_cancelled"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"follow_created|removed"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"post_published"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"campaign_impression"})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Ejemplo payload"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "event": "slot_published",\n  "slotId": "slot_456",\n  "ownerId": "u_biz1",\n  "start": "2025-08-21T10:30:00Z",\n  "end": "2025-08-21T11:00:00Z",\n  "visibility": "public",\n  "ts": "2025-08-20T10:00:00Z"\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"82-se\xf1ales-de-comportamiento",children:"8.2 Se\xf1ales de comportamiento"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"slot_viewed"}),", ",(0,r.jsx)(s.code,{children:"card_clicked"}),", ",(0,r.jsx)(s.code,{children:"item_saved"}),", ",(0,r.jsx)(s.code,{children:"booked"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Ingesta por ",(0,r.jsx)(s.code,{children:"/feedback"})," ",(0,r.jsx)(s.strong,{children:"o"})," eventos. Agregaci\xf3n en Redis + lotes a almacenamiento fr\xedo si se requiere anal\xedtica."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"9-seguridad--privacidad",children:"9) Seguridad & Privacidad"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Respeto de visibilidad"}),": filtros por ",(0,r.jsx)(s.code,{children:"visibility"}),", ",(0,r.jsx)(s.code,{children:"timelineVisibility"}),", y scope de usuario en consultas a AI Search."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Opt\u2011in de localizaci\xf3n"}),": s\xf3lo aplicar ",(0,r.jsx)(s.code,{children:"near"}),"/",(0,r.jsx)(s.code,{children:"geoScore"})," si user consiente."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Cifrado"}),": secretos en Key Vault, TLS end\u2011to\u2011end."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"PII m\xednima"})," en \xedndices (referenciar ids, no datos sensibles)."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"10-costos-resumen-pr\xe1ctico",children:"10) Costos (resumen pr\xe1ctico)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Driver principal: ",(0,r.jsx)(s.strong,{children:"Azure AI Search"})," (SKU/replicas/partitions) + ",(0,r.jsx)(s.strong,{children:"tokens"})," de embeddings (batch)."]}),"\n",(0,r.jsxs)(s.li,{children:["Palancas: ",(0,r.jsx)(s.strong,{children:"S1"})," al inicio (1 r\xe9plica), ",(0,r.jsx)(s.strong,{children:"cache Redis"}),", embeddings ",(0,r.jsx)(s.strong,{children:"offline"}),", facets precomputadas populares."]}),"\n",(0,r.jsxs)(s.li,{children:["Compute IR: 1\u20132 pods chicos. DB core peque\xf1o (SQL/PG). Service Bus Basic/Standard. App Insights con ",(0,r.jsx)(s.strong,{children:"sampling"})," 10\u201320%."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"11-kpis--observabilidad",children:"11) KPIs & Observabilidad"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"p95"})," ",(0,r.jsx)(s.code,{children:"/search"}),", ",(0,r.jsx)(s.code,{children:"/feed"}),"; ",(0,r.jsx)(s.strong,{children:"error rate"}),"; ",(0,r.jsx)(s.strong,{children:"freshness"})," (<10s)."]}),"\n",(0,r.jsxs)(s.li,{children:["CTR de feed/search, ",(0,r.jsx)(s.strong,{children:"NDCG@10"})," (si aplicable), % resultados vac\xedos."]}),"\n",(0,r.jsxs)(s.li,{children:["Trazas OTel con ",(0,r.jsx)(s.code,{children:"traceId"})," propagado (FE\u2192BFF\u2192IR\u2192AI Search/Redis)."]}),"\n",(0,r.jsx)(s.li,{children:"Dashboards: latencia por filtro, hit ratio Redis, costo AI Search."}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"12-roadmap-de-evoluci\xf3n",children:"12) Roadmap de Evoluci\xf3n"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"MVP"}),": reglas + mezcla BM25/Vector; embeddings batch; Redis cache; eventos b\xe1sicos."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Fase 1.5"}),": ranker LGBM/XGBoost, m\xe1s se\xf1ales, A/B simple, pesos por categor\xeda."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Fase 2"}),": Event Hubs/Kafka (si crece anal\xedtica), feature store ligero; posibilidad de ",(0,r.jsx)(s.strong,{children:"migrar provider"})," (Elastic+pgvector) sin tocar FE/BFF."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"13-adr--ir001-decisi\xf3n-de-arquitectura",children:"13) ADR \u2014 IR\u2011001 (Decisi\xf3n de Arquitectura)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Decisi\xf3n"}),": IR Service en ",(0,r.jsx)(s.strong,{children:"Python FastAPI"})," con ",(0,r.jsx)(s.strong,{children:"Azure AI Search"}),"; embeddings batch con Azure OpenAI; ranking propio."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Alternativas"}),": .NET IR con AI Search; Elastic+pgvector self\u2011hosted."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Motivo"}),": mejor ",(0,r.jsx)(s.strong,{children:"velocidad de experimento"})," y ",(0,r.jsx)(s.strong,{children:"control de ranking"})," manteniendo bajo costo operativo."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Estado"}),": Aprobado (MVP). Revisi\xf3n en Fase 1.5."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"14-test--acceptance-criteria",children:"14) Test / Acceptance Criteria"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"/search"})," y ",(0,r.jsx)(s.code,{children:"/feed"})," p95 \u2264 ",(0,r.jsx)(s.strong,{children:"300 ms"})," (staging), ",(0,r.jsx)(s.strong,{children:"error rate"})," < 1%."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Freshness"})," indices < ",(0,r.jsx)(s.strong,{children:"10s"})," tras ",(0,r.jsx)(s.code,{children:"slot_published"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Cache hit"})," en Redis \u2265 40% para queries populares."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Privacidad"}),": consultas respetan visibilidad y opt\u2011in geo (tests)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Observabilidad"}),": trazas completas con ",(0,r.jsx)(s.code,{children:"traceId"}),", m\xe9tricas y logs accionables."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"15-riesgos--open-questions",children:"15) Riesgos & Open Questions"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Costos"})," si crece AI Search \u2192 monitorear uso/replicas; cache/facets."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Sesgos"})," en ranking \u2192 logging de contribuci\xf3n de features; validaci\xf3n offline."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Vendor lock\u2011in"})," \u2192 ",(0,r.jsx)(s.code,{children:"SearchProvider"})," pluggable; pruebas con Elastic/pgvector."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"GPU/Modelos pesados"})," (futuro) \u2192 separar ",(0,r.jsx)(s.strong,{children:"servicio de inferencia"})," y orquestar desde IR."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"-checklist--next-steps",children:"\u2705 Checklist / Next Steps"}),"\n",(0,r.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Definir versi\xf3n de embeddings (",(0,r.jsx)(s.code,{children:"embedding_v1"}),") y dimensiones."]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Crear \xedndices en ",(0,r.jsx)(s.strong,{children:"Azure AI Search"})," (offering/slot/profile/post)."]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Implementar ",(0,r.jsx)(s.strong,{children:"IR Service"})," (FastAPI) con endpoints ",(0,r.jsx)(s.code,{children:"/search"}),", ",(0,r.jsx)(s.code,{children:"/feed"}),", ",(0,r.jsx)(s.code,{children:"/feedback"}),"."]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Implementar ",(0,r.jsx)(s.strong,{children:"Indexador"})," (Service Bus \u2192 IR \u2192 AI Search)."]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","A\xf1adir ",(0,r.jsx)(s.strong,{children:"Redis"})," (cache + features online)."]}),"\n",(0,r.jsxs)(s.li,{className:"task-list-item",children:[(0,r.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Configurar ",(0,r.jsx)(s.strong,{children:"OTel + App Insights"})," y alertas de p95, freshness y errores."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>l});var i=n(6540);const r={},d=i.createContext(r);function c(e){const s=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(d.Provider,{value:s},e.children)}}}]);