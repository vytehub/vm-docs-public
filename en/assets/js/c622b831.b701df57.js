"use strict";(self.webpackChunkvyte_merge_docs=self.webpackChunkvyte_merge_docs||[]).push([[8002],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var s=i(96540);const o={},r=s.createContext(o);function l(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(r.Provider,{value:n},e.children)}},45339:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"domain-behavior/core-flows/open-and-book","title":"Flow 02 - Abrir Listing y crear Booking","description":"Un Guest/Usuario abre un listing (o slot) y confirma una reserva que termina creando un Booking y un Event en el Timeline.","source":"@site/docs/01-domain-behavior/01-core-flows/02-open-and-book.md","sourceDirName":"01-domain-behavior/01-core-flows","slug":"/domain-behavior/core-flows/open-and-book","permalink":"/vm-docs-public/en/docs/domain-behavior/core-flows/open-and-book","draft":false,"unlisted":false,"editUrl":"https://github.com/vytehub/vm-docs/tree/main/docs/01-domain-behavior/01-core-flows/02-open-and-book.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Flow 02 - Abrir Listing y crear Booking","description":"Un Guest/Usuario abre un listing (o slot) y confirma una reserva que termina creando un Booking y un Event en el Timeline."},"sidebar":"tutorialSidebar","previous":{"title":"Flow 01 - Publicar Listing y habilitar Slots","permalink":"/vm-docs-public/en/docs/domain-behavior/core-flows/publish-listing"},"next":{"title":"Flow 03 - Follow, aprobaci\xf3n y Feed","permalink":"/vm-docs-public/en/docs/domain-behavior/core-flows/follow-and-feed"}}');var o=i(74848),r=i(28453);const l={title:"Flow 02 - Abrir Listing y crear Booking",description:"Un Guest/Usuario abre un listing (o slot) y confirma una reserva que termina creando un Booking y un Event en el Timeline."},c="Flow 02 \u2014 Abrir Listing y crear Booking",d={},a=[{value:"Resumen",id:"resumen",level:2},{value:"Preconditions",id:"preconditions",level:2},{value:"Main Flow (paso a paso)",id:"main-flow-paso-a-paso",level:2},{value:"Domain Trace (Command \u2192 Aggregate \u2192 Event)",id:"domain-trace-command--aggregate--event",level:2},{value:"Edge Cases",id:"edge-cases",level:2},{value:"Links (fuente de verdad)",id:"links-fuente-de-verdad",level:2}];function t(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"flow-02--abrir-listing-y-crear-booking",children:"Flow 02 \u2014 Abrir Listing y crear Booking"})}),"\n",(0,o.jsx)(n.h2,{id:"resumen",children:"Resumen"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Goal:"})," permitir que un usuario reserve un slot (o solicite un horario) y el sistema cree un Booking + Event en el Timeline correspondiente."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Actores:"})," Guest/Usuario, Sistema VyteMerge, Business."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Contextos:"})," Offer (Listing), Supply (Timeline/Slots), Governance (Access), Communication (notifications), (opcional) Payments/Orders."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"preconditions",children:"Preconditions"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Listing est\xe1 ",(0,o.jsx)(n.strong,{children:"Published"})," y visible para el usuario (channels/visibility + privacy)."]}),"\n",(0,o.jsxs)(n.li,{children:["Existe disponibilidad proyectada (Slots) o el listing permite \u201con request\u201d. ",(0,o.jsx)(n.strong,{children:"NEEDS CLARIFICATION"})]}),"\n",(0,o.jsx)(n.li,{children:"Se conoce Place/timezone para interpretaci\xf3n del horario."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"main-flow-paso-a-paso",children:"Main Flow (paso a paso)"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Usuario abre el Listing (por link, feed, search) o abre un Slot deep link."}),"\n",(0,o.jsxs)(n.li,{children:["Sistema valida Access/Visibility:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"perfil/owner visibility"}),"\n",(0,o.jsx)(n.li,{children:"listing visibility (public/unlisted/private)"}),"\n",(0,o.jsx)(n.li,{children:"reglas de eligibility (si existen)"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Usuario selecciona un Slot (o propone alternativa) y completa el Form (intake)."}),"\n",(0,o.jsxs)(n.li,{children:["Sistema intenta crear la reserva:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"revalida disponibilidad (para evitar carreras)"}),"\n",(0,o.jsx)(n.li,{children:"aplica capacity/shared capacity"}),"\n",(0,o.jsx)(n.li,{children:"aplica booking rules (ventanas, pol\xedticas, etc.)"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Sistema crea ",(0,o.jsx)(n.strong,{children:"Booking"})," (estado inicial) y crea/actualiza un ",(0,o.jsx)(n.strong,{children:"Event"})," en el Timeline del Business (y/o del usuario seg\xfan dise\xf1o)."]}),"\n",(0,o.jsxs)(n.li,{children:["Sistema emite notificaciones:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"confirmaci\xf3n al usuario"}),"\n",(0,o.jsx)(n.li,{children:"aviso al business"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"UI muestra confirmaci\xf3n y detalle (con timezone correcto)."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"domain-trace-command--aggregate--event",children:"Domain Trace (Command \u2192 Aggregate \u2192 Event)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Command:"})," ",(0,o.jsx)(n.code,{children:"ViewListing"})," (lectura)","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Read models:"})," listing details + projected slots"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Command:"})," ",(0,o.jsx)(n.code,{children:"RequestBooking"})," / ",(0,o.jsx)(n.code,{children:"CreateBooking"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Aggregate:"})," ",(0,o.jsx)(n.code,{children:"Booking"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Invariants:"})," slot disponible; pol\xedticas; capacity; privacy."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Events:"})," ",(0,o.jsx)(n.code,{children:"BookingRequested"})," / ",(0,o.jsx)(n.code,{children:"BookingCreated"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Command:"})," ",(0,o.jsx)(n.code,{children:"AttachBookingToTimeline"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Aggregate:"})," ",(0,o.jsx)(n.code,{children:"Timeline"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Events:"})," ",(0,o.jsx)(n.code,{children:"EventCreated"})," / ",(0,o.jsx)(n.code,{children:"EventUpdated"})," (con referencia a booking)"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Projections:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SlotsReprojected"})," / slot marcado como reservado"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"NotificationsEnqueued"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"DashboardMetricsUpdated"})," (si aplica)"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Opcional Payments:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Command:"})," ",(0,o.jsx)(n.code,{children:"CreateOrder"})," \u2192 ",(0,o.jsx)(n.strong,{children:"Event:"})," ",(0,o.jsx)(n.code,{children:"OrderCreated"})," \u2192 ",(0,o.jsx)(n.code,{children:"PaymentCaptured"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"edge-cases",children:"Edge Cases"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Carreras: dos usuarios intentando el mismo slot (idempotencia + recheck)."}),"\n",(0,o.jsx)(n.li,{children:"Cancelaci\xf3n/no-show: ver lifecycle."}),"\n",(0,o.jsx)(n.li,{children:"Timezone mismatch: slot/hora debe persistirse con reglas claras (DateOnly vs DateTime)."}),"\n",(0,o.jsx)(n.li,{children:"Listing Unpublished mientras usuario est\xe1 en pantalla: bloquear confirmaci\xf3n."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"links-fuente-de-verdad",children:"Links (fuente de verdad)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Slots & Booking rules (Listing): ",(0,o.jsx)(n.code,{children:"docs/00-core-domain/04-bounded-contexts/03.Offer - Catalog & Listings/02.listing/05.booking_rules.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Capacity/shared capacity: ",(0,o.jsx)(n.code,{children:"docs/00-core-domain/04-bounded-contexts/03.Offer - Catalog & Listings/02.listing/06.capacity_shared_capacity.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Scheduling / slots: ",(0,o.jsx)(n.code,{children:"docs/00-core-domain/04-bounded-contexts/03.Offer - Catalog & Listings/02.listing/04.scheduling_slots.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Timeline conflict rules: ",(0,o.jsx)(n.code,{children:"docs/00-core-domain/04-bounded-contexts/02.Supply - Time & Place/01.timelines/02.timeline_conflict_rules.md"})]}),"\n",(0,o.jsxs)(n.li,{children:["Notifications overview: ",(0,o.jsx)(n.code,{children:"docs/00-core-domain/04-bounded-contexts/05.Communication/02.notifications/01.overview.md"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}}}]);